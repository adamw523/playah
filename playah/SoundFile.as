package playah {	import flash.media.Sound;	import flash.media.SoundChannel;	import flash.net.URLRequest;	import flash.events.Event;	import flash.events.ProgressEvent;	import flash.events.TimerEvent;	import flash.utils.Timer;	import flash.text.TextField;	import flash.external.ExternalInterface;	public class SoundFile {		private var key:String;		private var sound:Sound;		private var soundChannel:Object = null;		private var position:Number = 0;		private var soundCompleteListenerCallback:Function;		private var positionTimerHandler:Function;		private var positionTimer:Timer;				private function soundCompleteListener(e:Event):void {			soundChannel = null;			position = 0;			positionTimer.stop();			soundCompleteListenerCallback.call();		}				public function SoundFile(key:String, url:String, loaded:Function, scl:Function, pth:Function):void {			sound = new Sound();			sound.load(new URLRequest(url));			sound.addEventListener(Event.COMPLETE, loaded);			soundCompleteListenerCallback = scl;			positionTimerHandler = pth;		}		public function play():void {			if(!soundChannel) {				soundChannel = sound.play(position);				soundChannel.addEventListener(Event.SOUND_COMPLETE, soundCompleteListener);				positionTimer = new Timer(100);				positionTimer.addEventListener(TimerEvent.TIMER, positionTimerHandler);	            positionTimer.start();			}		}				public function playFromPosition(inPosition:Number) {			stop();			if(inPosition <= sound.length) {				position = inPosition;				play();			}		}				public function pause():void {			if(soundChannel) {				position = soundChannel.position;				soundChannel.stop();				soundChannel = null;			}						if(positionTimer) {				positionTimer.stop();			}		}				public function stop():void {			position = 0;			if(soundChannel) {				soundChannel.stop();				soundChannel = null;			}			if(positionTimer) {				positionTimer.stop();			}		}				private function updatePosition():void {			if(soundChannel) {				position = soundChannel.position;			}		}				public function toJson():String {			updatePosition();						var json : String = '{';			json += '"length": ' + sound.length;			if(sound.length > 0) {				json += ', "loaded_percent": ' +  sound.bytesLoaded / sound.bytesTotal * 100;				json += ', "bytes_total": ' + sound.bytesTotal;				json += ', "position": ' + position;			} else {				json += ', "loaded_percent": ' + 0;			}			json += '}';						return json;		}			}}